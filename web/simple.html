<!doctype html>
<html lang="fr" style="color-scheme: dark;">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Coach ‚Äî Simple & Intelligent</title>
  <style>
    :root{
      --bg:#0b0b0e;--panel:#121217;--muted:#6b7280;--text:#e5e7eb;--accent:#4f46e5;--accent-2:#22d3ee;
      --success:#10b981;--warning:#f59e0b;--error:#ef4444;--radius:16px;--radius-sm:12px;
      --me:#1f2937;--them:#0d9488;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      background:linear-gradient(135deg,#0a0a0d 0%,#0b0b0e 50%,#0d0d11 100%);
      color:var(--text);font:16px/1.4 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Inter,system-ui;
      display:flex;flex-direction:column;padding:16px;max-width:800px;margin:0 auto;
    }

    /* Header minimaliste */
    .header{
      text-align:center;padding:20px 0;margin-bottom:20px;
    }
    .header h1{
      font-size:28px;font-weight:700;margin:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
    }
    .header p{
      color:var(--muted);font-size:14px;margin:8px 0 0 0;
    }

    /* Zone de chat principale */
    .chat-container{
      flex:1;background:rgba(18,18,23,.9);backdrop-filter:blur(12px);
      border:1px solid #1f2430;border-radius:24px;display:flex;flex-direction:column;
      box-shadow:0 20px 40px rgba(0,0,0,.4);overflow:hidden;min-height:400px;
    }

    .chat-messages{
      flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:16px;
    }

    .message{
      max-width:85%;padding:14px 18px;border-radius:18px;position:relative;
      line-height:1.5;word-wrap:break-word;
    }
    .message.user{
      align-self:flex-end;background:linear-gradient(135deg,var(--me),#374151);
      border-bottom-right-radius:6px;color:white;
    }
    .message.assistant{
      align-self:flex-start;background:linear-gradient(135deg,var(--them),#059669);
      border-bottom-left-radius:6px;color:white;
    }

    /* Indicateurs de statut */
    .status-indicator{
      display:inline-flex;align-items:center;gap:6px;font-size:12px;
      padding:4px 8px;border-radius:12px;margin-top:8px;
    }
    .status-indicator.success{background:var(--success);color:white;}
    .status-indicator.warning{background:var(--warning);color:black;}
    .status-indicator.error{background:var(--error);color:white;}

    /* Zone de saisie intelligente */
    .input-area{
      border-top:1px solid #1f2430;padding:20px;background:var(--panel);
    }

    .input-container{position:relative;}
    .input-container textarea{
      width:100%;min-height:60px;max-height:120px;resize:none;
      background:#0f0f14;border:2px solid #222739;border-radius:16px;
      color:var(--text);padding:16px 50px 16px 16px;font-size:16px;
      transition:border-color 0.2s;
    }
    .input-container textarea:focus{
      outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(79,70,229,0.1);
    }
    .input-container textarea::placeholder{color:var(--muted);}

    .send-button{
      position:absolute;right:12px;bottom:12px;width:36px;height:36px;
      background:linear-gradient(135deg,var(--accent),var(--accent-2));
      border:0;border-radius:50%;color:white;cursor:pointer;
      display:flex;align-items:center;justify-content:center;font-size:18px;
      transition:transform 0.2s,box-shadow 0.2s;
    }
    .send-button:hover{transform:scale(1.05);box-shadow:0 4px 12px rgba(79,70,229,0.3);}
    .send-button:active{transform:scale(0.95);}

    /* Raccourcis intelligents */
    .quick-actions{
      display:flex;gap:8px;margin-top:16px;flex-wrap:wrap;
    }
    .quick-btn{
      background:#0f0f14;border:1px solid #222739;border-radius:12px;
      color:var(--text);padding:8px 12px;font-size:13px;cursor:pointer;
      transition:background 0.2s,border-color 0.2s;
    }
    .quick-btn:hover{background:#1a1a1f;border-color:#374151;}
    .quick-btn:active{background:#222739;}

    /* Indicateur de frappe */
    .typing-indicator{
      display:flex;gap:4px;padding:12px 18px;background:var(--them);
      border-radius:18px;border-bottom-left-radius:6px;width:fit-content;
      margin-bottom:8px;
    }
    .typing-dot{
      width:6px;height:6px;background:white;border-radius:50%;
      animation:typing 1.4s infinite;
    }
    .typing-dot:nth-child(2){animation-delay:0.2s;}
    .typing-dot:nth-child(3){animation-delay:0.4s;}

    @keyframes typing{
      0%,60%,100%{opacity:0.3;}
      30%{opacity:1;}
    }

    /* Animations d'entr√©e */
    .message{animation:slideIn 0.3s ease-out;}
    @keyframes slideIn{
      from{opacity:0;transform:translateY(10px);}
      to{opacity:1;transform:translateY(0);}
    }

    /* Responsive */
    @media (max-width:640px){
      body{padding:12px;}
      .header h1{font-size:24px;}
      .chat-messages{padding:16px;}
      .message{max-width:90%;padding:12px 16px;}
      .input-area{padding:16px;}
      .quick-actions{justify-content:center;}
    }

    /* √âtats de chargement */
    .loading{pointer-events:none;}
    .loading .send-button{animation:spin 1s linear infinite;}
    @keyframes spin{from{transform:rotate(0deg);}to{transform:rotate(360deg);}}
  </style>
</head>
<body>
  <div class="header">
    <h1>üß† Coach</h1>
    <p>Parlez naturellement, je m'occupe du reste</p>
  </div>

  <div class="chat-container">
    <div class="chat-messages" id="chatMessages">
      <div class="message assistant">
        Bonjour ! Je suis votre coach intelligent. Dites-moi simplement ce que vous voulez faire, et je m'occupe de tout automatiquement.
        <div class="status-indicator success">‚úì M√©moire synchronis√©e</div>
      </div>
    </div>

    <div class="input-area">
      <div class="input-container">
        <textarea id="userInput" placeholder="Ex: 'M√©morise cette info importante', 'Analyse ce document', 'V√©rifie le statut'..."></textarea>
        <button class="send-button" id="sendButton">‚Üë</button>
      </div>

      <div class="quick-actions">
        <button class="quick-btn" onclick="quickAction('M√©morise: ')">üìù M√©moriser</button>
        <button class="quick-btn" onclick="quickAction('Guide ma r√©ponse √† ')">üí¨ R√©pondre</button>
        <button class="quick-btn" onclick="quickAction('Corrige ce texte en fran√ßais: ')">üá´üá∑ Corriger FR</button>
        <button class="quick-btn" onclick="quickAction('Corrige ce texte en anglais: ')">üá¨üáß Corriger EN</button>
        <button class="quick-btn" onclick="quickAction('Traduis en fran√ßais: ')">‚ÜîÔ∏è Vers FR</button>
        <button class="quick-btn" onclick="quickAction('Traduis en anglais: ')">‚ÜîÔ∏è Vers EN</button>
        <button class="quick-btn" onclick="quickAction('Analyse cette conversation: ')">ÔøΩ Analyser</button>
        <button class="quick-btn" onclick="quickAction('V√©rifie le statut')">‚ö° Diagnostic</button>
        <button class="quick-btn" onclick="quickAction('Liste mes m√©moires')">üìã Consulter</button>
        <button class="quick-btn" onclick="clearChat()">üóëÔ∏è Effacer</button>
      </div>
    </div>
  </div>

  <script>
    const apiBase = window.location.hostname === 'localhost' ? 'http://localhost:5057' : '';
    const chatMessages = document.getElementById('chatMessages');
    const userInput = document.getElementById('userInput');
    const sendButton = document.getElementById('sendButton');

    let isProcessing = false;

    // Fonctions utilitaires
    function addMessage(text, type = 'assistant', status = null) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${type}`;

      // Traitement sp√©cial pour les messages avec formatage
      if (text.includes('\n')) {
        messageDiv.innerHTML = text.replace(/\n/g, '<br>');
      } else {
        messageDiv.textContent = text;
      }

      if (status) {
        const statusDiv = document.createElement('div');
        statusDiv.className = `status-indicator ${status.type}`;
        statusDiv.textContent = status.text;
        messageDiv.appendChild(statusDiv);
      }

      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function showTypingIndicator() {
      const indicator = document.createElement('div');
      indicator.className = 'typing-indicator';
      indicator.id = 'typingIndicator';
      indicator.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
      chatMessages.appendChild(indicator);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function hideTypingIndicator() {
      const indicator = document.getElementById('typingIndicator');
      if (indicator) indicator.remove();
    }

    function setProcessingState(processing) {
      isProcessing = processing;
      document.body.classList.toggle('loading', processing);
      sendButton.disabled = processing;
      userInput.disabled = processing;
    }

    // Actions rapides
    function quickAction(prefix) {
      userInput.value = prefix;
      userInput.focus();
      userInput.setSelectionRange(prefix.length, prefix.length);
    }

    function clearChat() {
      if (confirm('Effacer tout l\'historique de conversation ?')) {
        chatMessages.innerHTML = '';
        addMessage('Historique effac√©. Nouvelle conversation commenc√©e.', 'assistant', {type: 'success', text: '‚úì Pr√™t'});
      }
    }

    // Fonction principale de conversation
    async function sendMessage() {
      const message = userInput.value.trim();
      if (!message || isProcessing) return;

      // Ajouter le message utilisateur
      addMessage(message, 'user');

      // Vider l'input et d√©sactiver
      userInput.value = '';
      setProcessingState(true);

      // Afficher l'indicateur de frappe
      showTypingIndicator();

      try {
        const response = await fetch(`${apiBase}/coach/converse`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            message: message,
            session_id: 'simple_ui_' + Date.now() // Session unique pour cette interface
          })
        });

        if (!response.ok) {
          throw new Error(`Erreur HTTP ${response.status}`);
        }

        const data = await response.json();
        hideTypingIndicator();

        if (data.error) {
          addMessage(`Erreur: ${data.error}`, 'assistant', {type: 'error', text: '‚úó Erreur'});
        } else if (data.response) {
          // D√©tecter le type de r√©ponse pour l'indicateur de statut
          let status = null;
          if (data.response.includes('‚úÖ') || data.response.includes('m√©moris√©')) {
            status = {type: 'success', text: '‚úì Sauvegard√©'};
          } else if (data.response.includes('‚ö†Ô∏è') || data.response.includes('attention')) {
            status = {type: 'warning', text: '‚ö†Ô∏è Attention'};
          }

          addMessage(data.response, 'assistant', status);
        } else {
          addMessage(JSON.stringify(data, null, 2), 'assistant');
        }

      } catch (error) {
        hideTypingIndicator();
        addMessage(`Erreur de connexion: ${error.message}`, 'assistant', {type: 'error', text: '‚úó Connexion'});
      } finally {
        setProcessingState(false);
      }
    }

    // √âv√©nements
    sendButton.addEventListener('click', sendMessage);

    userInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    // Auto-focus sur l'input
    window.addEventListener('load', () => {
      userInput.focus();
    });

    // Message de bienvenue am√©lior√©
    setTimeout(() => {
      addMessage(
        'üí° Conseils d\'utilisation :\n' +
        '‚Ä¢ Parlez naturellement, pas besoin de commandes complexes\n' +
        '‚Ä¢ Dites "m√©morise" pour sauvegarder automatiquement\n' +
        '‚Ä¢ Je classe tout intelligemment pour vous\n' +
        '‚Ä¢ Votre m√©moire est synchronis√©e et infaillible',
        'assistant',
        {type: 'success', text: '‚úì Interface pr√™te'}
      );
    }, 1000);
  </script>
</body>
</html></content>
<parameter name="filePath">/Users/mathieucourchesne/coach/web/simple.html